version: '3.8'

services:
  # Backend API - Conecta a MySQL externo
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: crm_ari_backend
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      # Production Environment Flag
      - ENVIRONMENT=production
      
      # Database Configuration - MySQL externo
      - DB_HOST=172.17.0.1  # IP del gateway Docker
      - DB_PORT=3306
      - DB_USERNAME=crm_user
      - DB_PASSWORD=crm_password_secure_2025
      - DB_DATABASE=crm_ari
      - DB_CHARSET=utf8mb4
      
      # Security Configuration
      - SECRET_KEY=crm-ari-super-secret-key-2025-production-ready
      - JWT_SECRET_KEY=crm_ari_jwt_secret_key_2025_change_in_production
      - JWT_ALGORITHM=HS256
      - JWT_ACCESS_TOKEN_EXPIRE_MINUTES=480
      - BCRYPT_ROUNDS=12
      
      # Application Configuration
      - APP_NAME=CRM ARI Family Assets
      - APP_VERSION=2.0.0
      - DEBUG=false
      
      # CORS Configuration
      - CORS_ORIGINS=https://crm.arifamilyassets.com,http://localhost:3000
    networks:
      - crm_network
    extra_hosts:
      - "host.docker.internal:host-gateway"  # Para Linux

networks:
  crm_network:
    driver: bridge