# Configuración Nginx para SPA en Plesk
# Archivo: plesk-nginx-spa.conf
# Ubicación sugerida: /var/www/vhosts/arifamilyassets.com/conf/vhost_nginx.conf

# Configuración para el dominio CRM
location / {
    try_files $uri $uri/ /index.html;
    
    # Headers para SPA y assets
    add_header Cache-Control "public, max-age=31536000" always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-Frame-Options DENY always;
    add_header X-XSS-Protection "1; mode=block" always;
}

# Assets estáticos (JS, CSS, imágenes)
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    add_header Vary Accept-Encoding;
}

# API Proxy (ya configurado)
location /api/ {
    proxy_pass http://127.0.0.1:8000/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Endpoint específico para health check
location /health {
    proxy_pass http://127.0.0.1:8000/health;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}