# âœ¨ CONFIGURACIÃ“N SPA REACT - AGREGAR AL INICIO
location / {
    try_files $uri $uri/ /index.html;
    
    # Cache para assets estÃ¡ticos
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# ðŸ”§ TUS DIRECTIVAS EXISTENTES (YA CONFIGURADAS)
location /api/ {
	proxy_pass http://127.0.0.1:8000;
	proxy_set_header Host $host;
	proxy_set_header X-Real-IP $remote_addr;
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header X-Forwarded-Proto $scheme;
	proxy_set_header X-Forwarded-Host $server_name;

	# CORS headers
	add_header Access-Control-Allow-Origin * always;
	add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS, PUT, DELETE' always;
	add_header Access-Control-Allow-Headers 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization' always;
	add_header Access-Control-Allow-Credentials false always;

	if ($request_method = 'OPTIONS') {
		add_header Access-Control-Allow-Origin * always;
		add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS, PUT, DELETE' always;
		add_header Access-Control-Allow-Headers 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization' always;
		add_header Access-Control-Max-Age 1728000 always;
		add_header Content-Type 'text/plain charset=UTF-8' always;
		add_header Content-Length 0 always;
		return 204;
	}
}

location /docs {
	proxy_pass http://127.0.0.1:8000;
	proxy_set_header Host $host;
	proxy_set_header X-Real-IP $remote_addr;
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header X-Forwarded-Proto $scheme;
	proxy_set_header X-Forwarded-Host $server_name;
}

location /redoc {
	proxy_pass http://127.0.0.1:8000;
	proxy_set_header Host $host;
	proxy_set_header X-Real-IP $remote_addr;
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header X-Forwarded-Proto $scheme;
	proxy_set_header X-Forwarded-Host $server_name;
}

location /openapi.json {
	proxy_pass http://127.0.0.1:8000;
	proxy_set_header Host $host;
	proxy_set_header X-Real-IP $remote_addr;
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header X-Forwarded-Proto $scheme;
	proxy_set_header X-Forwarded-Host $server_name;
}

location /health {
	proxy_pass http://127.0.0.1:8000;
	proxy_set_header Host $host;
	proxy_set_header X-Real-IP $remote_addr;
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header X-Forwarded-Proto $scheme;
	proxy_set_header X-Forwarded-Host $server_name;

	# CORS headers para health check
	add_header Access-Control-Allow-Origin * always;
	add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS' always;
	add_header Access-Control-Allow-Headers 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization' always;
	add_header Access-Control-Allow-Credentials false always;

	if ($request_method = 'OPTIONS') {
		add_header Access-Control-Allow-Origin * always;
		add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS' always;
		add_header Access-Control-Allow-Headers 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization' always;
		add_header Access-Control-Max-Age 1728000 always;
		add_header Content-Type 'text/plain charset=UTF-8' always;
		add_header Content-Length 0 always;
		return 204;
	}
}